<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Yuuki的小站">
    <meta name="description" content="Yuuki的小站">
    <meta name="author" content="yuuki">
    
    <title>
        
            Nat类型 |
        
        Yuuki的小站
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"hanblog.fun","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"https://image.hanblog.fun/images/2022/04/27/06cc54c40991403a3f17178a8a09fd9e.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"我会一直写代码，直到我看不清屏幕的那一天。"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Yuuki的小站
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Nat类型</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://image.hanblog.fun/images/2022/04/27/06cc54c40991403a3f17178a8a09fd9e.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">yuuki</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2024-11-27 00:00:00</span>
        <span class="mobile">2024-11-27 00:00</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-NAT/">计算机网络 NAT</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h3 id="一、根据行为的NAT-类型分类"><a href="#一、根据行为的NAT-类型分类" class="headerlink" title="一、根据行为的NAT 类型分类"></a>一、根据行为的NAT 类型分类</h3><p>RFC 5780 对 NAT 行为主要从两方面进行分类：</p>
<ol>
<li><strong>地址相关映射行为（Address-dependent Mapping Behavior）</strong><ul>
<li>当 NAT 为通信的内部 IP 和外部服务器创建映射（私有地址到公共地址）时，是否依赖于外部服务器的 IP 地址。</li>
</ul>
</li>
<li><strong>地址相关过滤行为（Address-dependent Filtering Behavior）</strong><ul>
<li>外部主机是否能够通过 NAT 映射后的地址与内部设备通信，并且是否限制这种通信仅来自已通信过的外部主机。</li>
</ul>
</li>
</ol>
<p>这两种行为的不同组合，总共形成 <strong>9 种 NAT 类型</strong>。</p>
<hr>
<h3 id="二、NAT-类型及其解析"><a href="#二、NAT-类型及其解析" class="headerlink" title="二、NAT 类型及其解析"></a>二、NAT 类型及其解析</h3><p>针对 NAT 的映射行为和过滤行为的不同表现：</p>
<h4 id="1-Endpoint-independent-Mapping（与端点无关的映射）"><a href="#1-Endpoint-independent-Mapping（与端点无关的映射）" class="headerlink" title="1. Endpoint-independent Mapping（与端点无关的映射）"></a>1. <strong>Endpoint-independent Mapping（与端点无关的映射）</strong></h4><ul>
<li><strong>定义</strong>：NAT 映射不依赖外部的目标地址（IP 地址或端口号），即不管内部设备连接哪个外部服务器，NAT 始终使用相同的映射。</li>
<li><strong>特点</strong>：这类似于 Full Cone NAT 或 Restricted Cone NAT，STUN 普遍支持它。</li>
</ul>
<h4 id="2-Address-dependent-Mapping（地址相关映射）"><a href="#2-Address-dependent-Mapping（地址相关映射）" class="headerlink" title="2. Address-dependent Mapping（地址相关映射）"></a>2. <strong>Address-dependent Mapping（地址相关映射）</strong></h4><ul>
<li><strong>定义</strong>：NAT 映射依赖外部目标地址 IP，即内部设备连接不同外部服务器时，对应的 NAT 映射也会有所不同。</li>
<li><strong>特点</strong>：安全性比 Endpoint-independent Mapping 更高，但通信自由度降低。</li>
</ul>
<h4 id="3-Address-and-Port-dependent-Mapping（地址和端口相关映射）"><a href="#3-Address-and-Port-dependent-Mapping（地址和端口相关映射）" class="headerlink" title="3. Address and Port-dependent Mapping（地址和端口相关映射）"></a>3. <strong>Address and Port-dependent Mapping（地址和端口相关映射）</strong></h4><ul>
<li><strong>定义</strong>：NAT 映射不仅依赖外部地址，还依赖目标服务器的端口号。对于同一个目服务器的不同端口，NAT 会为内部设备生成不同的映射。</li>
<li><strong>特点</strong>：与 Symmetric NAT 类似，穿透难度最大，需要 TURN 等中继方案。</li>
</ul>
<hr>
<p>针对 NAT 的过滤行为，分为以下三种类型：</p>
<h4 id="1-Endpoint-independent-Filtering（与端点无关的过滤）"><a href="#1-Endpoint-independent-Filtering（与端点无关的过滤）" class="headerlink" title="1. Endpoint-independent Filtering（与端点无关的过滤）"></a>1. <strong>Endpoint-independent Filtering（与端点无关的过滤）</strong></h4><ul>
<li><strong>定义</strong>：外部主机只要知道 NAT 的公网地址（IP + 端口）即可向内部设备发送数据包。</li>
<li><strong>特点</strong>：过滤机制最宽松，类似于完全圆锥 NAT。</li>
</ul>
<h4 id="2-Address-dependent-Filtering（地址相关过滤）"><a href="#2-Address-dependent-Filtering（地址相关过滤）" class="headerlink" title="2. Address-dependent Filtering（地址相关过滤）"></a>2. <strong>Address-dependent Filtering（地址相关过滤）</strong></h4><ul>
<li><strong>定义</strong>：仅允许那些已经建立过会话的外部主机发送数据包给 NAT 所创建的映射。</li>
<li><strong>特点</strong>：更严格的过滤行为，限制了不受信任外部设备的访问。</li>
</ul>
<h4 id="3-Address-and-Port-dependent-Filtering（地址和端口相关过滤）"><a href="#3-Address-and-Port-dependent-Filtering（地址和端口相关过滤）" class="headerlink" title="3. Address and Port-dependent Filtering（地址和端口相关过滤）"></a>3. <strong>Address and Port-dependent Filtering（地址和端口相关过滤）</strong></h4><ul>
<li><strong>定义</strong>：只有来自特定目标地址和端口号的外部主机才能访问 NAT 映射。</li>
<li><strong>特点</strong>：过滤行为最严格，安全性最高。</li>
</ul>
<hr>
<h3 id="三、组合行为（9-类-NAT-类型）"><a href="#三、组合行为（9-类-NAT-类型）" class="headerlink" title="三、组合行为（9 类 NAT 类型）"></a>三、组合行为（9 类 NAT 类型）</h3><p>通过<strong>映射行为</strong>和<strong>过滤行为</strong>的组合，NAT 总共形成 9 种具体类型：</p>
<table>
<thead>
<tr>
<th>映射行为</th>
<th>过滤行为</th>
<th>NAT 类型描述</th>
</tr>
</thead>
<tbody><tr>
<td>Endpoint-independent</td>
<td>Endpoint-independent</td>
<td>Full Cone NAT</td>
</tr>
<tr>
<td>Endpoint-independent</td>
<td>Address-dependent</td>
<td>Restricted Cone NAT</td>
</tr>
<tr>
<td>Endpoint-independent</td>
<td>Address and Port-dependent</td>
<td>Port Restricted Cone NAT</td>
</tr>
<tr>
<td>Address-dependent</td>
<td>Endpoint-independent</td>
<td>特殊类型（较少见）</td>
</tr>
<tr>
<td>Address-dependent</td>
<td>Address-dependent</td>
<td>常见安全 NAT</td>
</tr>
<tr>
<td>Address-dependent</td>
<td>Address and Port-dependent</td>
<td>Address and Port-restricted NAT</td>
</tr>
<tr>
<td>Address and Port-dependent</td>
<td>Endpoint-independent</td>
<td>特殊类型（几乎不存在）</td>
</tr>
<tr>
<td>Address and Port-dependent</td>
<td>Address-dependent</td>
<td>高安全 NAT</td>
</tr>
<tr>
<td>Address and Port-dependent</td>
<td>Address and Port-dependent</td>
<td>Symmetric NAT (对称 NAT，常见)</td>
</tr>
</tbody></table>
<h4 id="从使用角度来看："><a href="#从使用角度来看：" class="headerlink" title="从使用角度来看："></a>从使用角度来看：</h4><ol>
<li><strong>Full Cone NAT（完全圆锥 NAT）</strong>：<ul>
<li>最开放的 NAT 行为，通信最自由，P2P 协议支持最好。</li>
<li>穿透最简单，但安全性较低。</li>
</ul>
</li>
<li><strong>Symmetric NAT（对称 NAT）</strong>：<ul>
<li>最严格和动态的映射机制，安全性高。</li>
<li>最不利于 NAT 穿透，需要 TURN 中继服务器协助通信。</li>
</ul>
</li>
<li><strong>其他中间类型</strong>：<ul>
<li>大部分 NAT 则在这两端之间，具体表现为受限过滤和地址依赖映射策略，安全性和通信灵活性之间达到平衡。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="四、RFC-5780-中检测-NAT-类型的方法"><a href="#四、RFC-5780-中检测-NAT-类型的方法" class="headerlink" title="四、RFC 5780 中检测 NAT 类型的方法"></a>四、RFC 5780 中检测 NAT 类型的方法</h3><p>RFC 5780 建议通过扩展 <strong>STUN（Session Traversal Utilities for NAT）协议</strong> 来检测 NAT 类型，具体方法包括以下几个步骤：</p>
<ol>
<li><strong>映射行为测试</strong><ul>
<li>向 STUN 服务器发送测试请求，检测返回的外部地址。</li>
<li>同时改变请求的目标地址或端口，观察 NAT 映射地址是否变化，从而判断 NAT 映射的行为：<ul>
<li><strong>地址无关映射（Endpoint-independent Mapping）</strong>：映射保持不变。</li>
<li><strong>地址相关映射（Address-dependent Mapping）</strong>：映射随目标地址变化。</li>
<li><strong>端口相关映射（Address and Port-dependent Mapping）</strong>：映射随目标地址和端口变化。</li>
</ul>
</li>
</ul>
</li>
<li><strong>过滤行为测试</strong><ul>
<li>通过 STUN 服务器不同 IP 和端口向 NAT 映射地址发送数据包，观察内部设备是否能接收到：<ul>
<li><strong>地址无关过滤（Endpoint-independent Filtering）</strong>：数据包可通过。</li>
<li><strong>地址相关过滤（Address-dependent Filtering）</strong>：过滤未通信过的数据包。</li>
<li><strong>地址和端口相关过滤（Address and Port-dependent Filtering）</strong>：过滤所有不同源地址或端口端数据包。</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="五、NAT-的应用场景及优化"><a href="#五、NAT-的应用场景及优化" class="headerlink" title="五、NAT 的应用场景及优化"></a>五、NAT 的应用场景及优化</h3><ol>
<li><strong>互联网应用场景</strong>：<ul>
<li>P2P 网络、视频通话、在线游戏等，需要 NAT 穿透技术解决 NAT 带来的通信障碍。</li>
<li>采用标准 NAT 类型分类进行适配（如通过 STUN 检测并配置端口映射）。</li>
</ul>
</li>
<li><strong>NAT 优化建议</strong>：<ul>
<li>在苛刻的 NAT 类型（如 Symmetric NAT）下，可使用 TURN 中继服务器进行流量中转。</li>
<li>启用 UPnP（通用即插即用）或 NAT-PMP（NAT 端口映射协议）动态创建映射规则。</li>
<li>对于有专用应用场景需求的网络，使用 Full Cone 或 Endpoint-independent NAT 可以最大程度优化通信性能（如用于私有网络的实时通信）。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h3><p>基于 <strong>RFC 5780</strong>，NAT 类型可以通过映射行为和过滤行为组合细化为 9 种具体类型。这种细分方式可以更加精准地描述 NAT 行为，尤其是帮助 STUN、TURN 和 ICE 等技术在实际网络环境中更高效地穿透 NAT。</p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-NAT/">#计算机网络 NAT</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2024/12/02/2024-12-02-WebRTC%E6%98%AF%E4%BB%80%E4%B9%88/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">WebRTC是什么</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2024/11/20/2024-11-20-FFmpeg_command/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">FFmpeg常用命令</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="twikoo-container">
        <script 
                src="//cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js"
        ></script>
        <div id="twikoo-comment"></div>
        <script >
            function loadTwikoo() {
                twikoo.init({
                    el: '#twikoo-comment',
                    envId: 'https://comment.hanblog.fun',
                    region: '',
                });
            }

            if ('false') {
                const loadTwikooTimeout = setTimeout(() => {
                    loadTwikoo();
                    clearTimeout(loadTwikooTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadTwikoo);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">yuuki</a>
			<a href="https://beian.miit.gov.cn/" target="_blank">鲁ICP备19036975号</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>







<div class="post-scripts">
    
</div>



</body>
</html>
